# swhisper Configuration File (Example Template)
# ===============================================
# Copy this file to `.swhisper.env` and update the values for your environment.
# Any variables left blank will fall back to project defaults.

# ============================================================================
# AUTHENTICATION TOKENS
# ============================================================================

# Hugging Face authentication token for pyannote models
HUGGING_FACE_TOKEN="***add*your*token*here***"

# Pyannote AI authentication token (commercial models)
PYANNOTEAI_API_KEY="***add*your*key*here***"

# ============================================================================
# DIRECTORY PATHS
# ============================================================================

# Directory containing source audio files for transcription runs - default: "audio"
#SWHISPER_AUDIO_DIR=/absolute/path/to/audio

# Directory to use for temporary working files and checkpoints - default: none
#SWHISPER_TEMP_DIR=/absolute/path/to/temp

# Default audio directory for diarization workflows (falls back to AUDIO_DIR if omitted) - default: none
#SWHISPER_DIARIZE_AUDIO_DIR=/absolute/path/to/diarization/audio

# JSON output directory for transcriptions - default: "whisper-json-output"
#SWHISPER_JSON_DIR=whisper-json-output

# Parent directory for diarization output subdirectories (relative to audio_dir) - default: transcripts
# Creates: {audio_dir}/{output_dir}/vtt, /rttm, /rtf, /txt, /tsv, /stats, /logs
#SWHISPER_OUTPUT_DIR=transcripts

# Parent directory for log files (relative to audio_dir)
#SWHISPER_LOG_DIR=transcripts

# Audio subdirectory within audio_dir
#SWHISPER_AUDIO_SUBDIR=

# Optional: Path to a locally downloaded strict Whisper model revision (legacy)
#SWHISPER_STRICT_MODEL_PATH=/path/to/local/model

# Optional: Sample audio file used by test scripts
#SWHISPER_SAMPLE_AUDIO_FILE=/path/to/sample.wav

# ============================================================================
# TRANSCRIPTION SETTINGS
# ============================================================================

# Whisper model identifier from HuggingFace - default: "KBLab/kb-whisper-large"
#SWHISPER_MODEL=KBLab/kb-whisper-large

# Model revision - default: "strict"
#SWHISPER_MODEL_REVISION=strict

# Processing device (cpu, cuda, mps) - default: "mps"
#SWHISPER_DEVICE=mps

# Maximum number of files to process in a batch - default: none (no limit)
#SWHISPER_FILE_LIMIT=

# Force reprocessing even if .ok file exists (true/false) - default: false
#SWHISPER_FORCE_REPROCESS=false

# Preserve checkpoint files after processing (true/false) - default: true
#SWHISPER_PRESERVE_CHECKPOINTS=true

# Target audio chunk duration in seconds - default: 180
#SWHISPER_CHUNK_DURATION=180

# Minimum silence duration to place chunk boundary (seconds) - default: 0.5
#SWHISPER_MIN_SILENCE=0.5

# Overlap duration between chunks (seconds) - default: 1.0
#SWHISPER_OVERLAP_DURATION=1.0

# Check model revision before processing (true/false) - default: false
#SWHISPER_CHECK_REVISION=false

# Check environment setup before processing (true/false) - default: true
#SWHISPER_CHECK_ENVIRONMENT=true

# ============================================================================
# WHISPER PROCESSING PARAMETERS
# ============================================================================

# Language code for transcription - default: "sv"
#SWHISPER_LANGUAGE=sv

# Task type: 'transcribe' or 'translate' - default: "transcribe"
#SWHISPER_TASK=transcribe

# Compute word-level confidence scores (true/false) - default: true
#SWHISPER_COMPUTE_CONFIDENCE=true

# Whisper precision refinement threshold - default: 0.5
#SWHISPER_REFINE_PRECISION=0.5

# Minimum word duration in seconds - default: 0.02
#SWHISPER_MIN_WORD_DURATION=0.02

# Number of top layers for word alignment - default: none
#SWHISPER_ALIGNMENT_LAYERS=

# Voice Activity Detector (e.g., "silero:v3.1") - default: "silero:v3.1"
#SWHISPER_VAD=silero:v3.1

# Detect disfluencies in speech (true/false) - default: true
#SWHISPER_DETECT_DISFLUENCIES=true

# Trust Whisper's own timestamps (true/false) - default: false
#SWHISPER_TRUST_TIMESTAMPS=false

# Beam search size - default: 5
#SWHISPER_BEAM_SIZE=5

# Best-of alternatives - default: 5
#SWHISPER_BEST_OF=5

# Temperature for sampling (comma-separated list) - default: "0.0,0.2,0.4,0.6,0.8,1.0"
#SWHISPER_TEMPERATURE=0.0,0.2,0.4,0.6,0.8,1.0

# Compression ratio threshold - default: 2.4
#SWHISPER_COMPRESSION_THRESHOLD=2.4

# Log probability threshold - default: -1.0
#SWHISPER_LOGPROB_THRESHOLD=-1.0

# No-speech confidence threshold - default: 0.6
#SWHISPER_NO_SPEECH_THRESHOLD=0.6

# Use half-precision floating point (true/false) - default: true
#SWHISPER_FP16=true

# Condition on previous text context (true/false) - default: true
#SWHISPER_CONDITION_ON_PREVIOUS=true

# Initial prompt text - default: "" (empty)
# Note that this prompt is included only with the first segment of each chunk. Waiting for whisper-timestamped to pass through carry_initial_prompt (see: https://github.com/linto-ai/whisper-timestamped/issues/225)
#SWHISPER_INITIAL_PROMPT=

# Tokens to suppress (comma-separated) - default: "50364"
#SWHISPER_SUPPRESS_TOKENS=50364

# Random seed for reproducibility - default: 1234
#SWHISPER_SEED=1234

# Verbose output (true/false) - default: true
#SWHISPER_VERBOSE=true

# ============================================================================
# DIARIZATION SETTINGS
# ============================================================================

# Minimum number of speakers - default: 1
#SWHISPER_MIN_SPEAKERS=2

# Maximum number of speakers - default: none
#SWHISPER_MAX_SPEAKERS=4

# Processing device for diarization (cpu, cuda, mps) - default: "mps"
#SWHISPER_DIARIZE_DEVICE=mps

# Force reprocess diarization even if output exists (true/false) - default: false
#SWHISPER_DIARIZE_FORCE_REPROCESS=false

# Pipeline model to use (ignored when using pyannote 4) - default: "pyannote/speaker-diarization-3.1"
#SWHISPER_PIPELINE_MODEL=pyannote/speaker-diarization-3.1

# Use exclusive speaker diarization (only available in Pyannote 4) (true/false) - default: true
#SWHISPER_USE_EXCLUSIVE_DIARIZATION=true

# ============================================================================
# DIARIZATION - LEGACY 3.1 PIPELINE PARAMETERS (AgglomerativeClustering)
# ============================================================================

# Use temporal constraints in speaker separation (true/false) - default: true
#SWHISPER_TEMPORAL_CONSTRAINTS=true

# Penalty for speaker changes - default: 0.1
#SWHISPER_SPEAKER_CHANGE_PENALTY=0.1

# Speaker similarity threshold - default: 0.6
#SWHISPER_EMBEDDING_THRESHOLD=0.6

# Speaker change sensitivity (segmentation threshold) - default: 0.01
#SWHISPER_SEGMENTATION_THRESHOLD=0.01

# Minimum speech duration (seconds) - default: none
#SWHISPER_MIN_DURATION_ON=

# Minimum silence duration (seconds) - default: none
#SWHISPER_MIN_DURATION_OFF=

# Clustering algorithm method - default: "centroid"
#SWHISPER_CLUSTERING_METHOD=centroid

# Minimum cluster size in frames - default: 15
#SWHISPER_CLUSTERING_MIN_SIZE=15

# Clustering threshold - default: 0.15
#SWHISPER_CLUSTERING_THRESHOLD=0.15

# ============================================================================
# DIARIZATION - COMMUNITY-1 PIPELINE PARAMETERS (VBxClustering)
# ============================================================================

# VBx clustering threshold - default 0.6; lower values create more speakers
#SWHISPER_VBX_THRESHOLD=0.6

# VBx false alarm probability - default 0.07; lower = more conservative speech detection
#SWHISPER_VBX_FA=0.07

# VBx probability of not detecting speaker - default 0.8; lower = more aggressive speaker separation
#SWHISPER_VBX_FB=0.8

# Minimum non-speech duration (seconds) - default: 0.0
#SWHISPER_COMMUNITY_MIN_DURATION_OFF=0.0

# ============================================================================
# DIARIZATION - PRECISION SERVICE (COMMERCIAL)
# ============================================================================

# Use pianoteAI Cloud API (true/false): default false
#SWHISPER_USE_PRECISION=false

# Precision pipeline model - default: "pyannote/speaker-diarization-precision-2"
#SWHISPER_PRECISION_MODEL=pyannote/speaker-diarization-precision-2

# ============================================================================
# OUTPUT FORMATTING
# ============================================================================

# Custom header text for transcripts (use \n for line breaks)
#SWHISPER_OUTPUT_PREAMBLE=

# Minimum silence duration to report (seconds) - default: 0.2
#SWHISPER_MIN_SILENCE_DURATION=0.2

# Include silence markers in transcript (true/false) - default: true
#SWHISPER_INCLUDE_SILENCE=true

# Silence threshold for blank lines in output (seconds) - default: 1.0
# Silences longer than this will be surrounded by blank lines in txt and rtf transcripts
#SWHISPER_SILENCE_LINEBREAK=1.0

# Preserve disfluency markers in output (true/false) - default: true
#SWHISPER_PRESERVE_MARKERS=true

# Log silence gaps to file (debugging) (true/false) - default: false
#SWHISPER_LOG_SILENCE=false

# Output one word per line in TSV format, e.g. for ELAN) (true/false) - default: true
# Since this format _also_ includes segment level data, there is not really any reason to turn this off.
#SWHISPER_TSV_WORD_PER_LINE=true

# ============================================================================
# MANUAL TIMESTAMP CORRECTION
# ============================================================================

# Offset to add to all Whisper timestamps (seconds) - default: 0.1
# This may improve alignment between Whisper word timestamps and the actual audio (and pyannote speaker segments).
# Set to 0.0 to disable the correction.
#SWHISPER_WHISPER_TIMESTAMP_OFFSET=0.1

# ============================================================================
# WORD-LEVEL PROCESSING
# ============================================================================

# Enable speaker assignment smoothing (true/false) - default: true
#SWHISPER_SMOOTHING_ENABLED=true

# Minimum words per speaker segment - default: 3
#SWHISPER_MIN_SPEAKER_WORDS=3

# ============================================================================
# BACKFILL SETTINGS (re-transcribe empty turns)
# ============================================================================

# Fill empty diarization turns with transcription (true/false) - default: true
#SWHISPER_BACKFILL_ENABLED=true

# Model to use for backfill - default: "KBLab/kb-whisper-large"
#SWHISPER_BACKFILL_MODEL=KBLab/kb-whisper-large

# Device for backfill processing - default: none
#SWHISPER_BACKFILL_DEVICE=

# Overlap for segment boundaries (seconds) - default: 0.5
#SWHISPER_BACKFILL_OVERLAP=0.5

# Save audio snippets during backfill, for debugging (true/false) - default: false
#SWHISPER_BACKFILL_SAVE_AUDIO=true

# Directory for backfill audio snippets - default: none
#SWHISPER_BACKFILL_SNIPPET_DIR=

# Enable caching of backfill results (true/false) - default: true
#SWHISPER_BACKFILL_CACHE_ENABLED=true

# Cache directory for backfill results - default: none
#SWHISPER_BACKFILL_CACHE_DIR=

# Minimum duration for backfill processing (seconds) - default: 0.1
# Empty turns shorter than this will be ignored
#SWHISPER_BACKFILL_MIN_DURATION=0.1

# Comma-separated list of words to ignore during backfill (hallucinations)
# These words will be replaced with disfluency markers
# Supports wildcards: use * to match any characters
# Examples: 
#   SWHISPER_BACKFILL_IGNORE_WORDS=Balans,Tack,Hej  (exact words)
#   SWHISPER_BACKFILL_IGNORE_WORDS=*:               (any word ending with colon)
#   SWHISPER_BACKFILL_IGNORE_WORDS=Musik*,*:,Balans (mixed patterns and exact words)
#SWHISPER_BACKFILL_IGNORE_WORDS=

# ============================================================================
# DIARIZATION CACHING
# ============================================================================

# Enable caching of raw pyannote diarization results (true/false) - default: true
# When enabled, diarization results are cached to avoid re-running diarization 
# on subsequent runs with the same audio and parameters
#SWHISPER_DIARIZATION_CACHE_ENABLED=true

# Cache directory for diarization results - default: transcripts/.diarization_cache
# Cache files are stored in RTTM format with keys based on audio file,
# model, and diarization parameters
#SWHISPER_DIARIZATION_CACHE_DIR=

# ============================================================================
# PARAMETER TESTING (ADVANCED)
# ============================================================================

# Enable parameter sweep testing (true/false) - default: false
#SWHISPER_PARAMETER_TESTING=false

# Test output directory - default: "parameter_tests"
#SWHISPER_TEST_OUTPUT_DIR=parameter_tests

# Maximum parameter combinations to test - default: 320
#SWHISPER_TEST_MAX_COMBINATIONS=320

# Test on single file first before full sweep (true/false) - default: true
#SWHISPER_TEST_SINGLE_FILE=true
